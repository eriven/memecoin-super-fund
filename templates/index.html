<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ Meme Super Fund Coin Cycle Capital ðŸŒ™</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .chart-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 1.2em;
            color: #ff69b4;
        }
        
        .dark-mode .chart-loading {
            color: #00ff9d;
        }
        
        .chart-error {
            color: #ff4444;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .dark-mode .chart-error {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <!-- Previous content remains the same until the chart container -->
    
    <div class="chart-container">
        <div id="chartStatus" class="chart-loading" style="display: none;">
            Loading Stonk Data... ðŸ“ˆ
        </div>
        <canvas id="performanceChart"></canvas>
        <div id="chartError" class="chart-error"></div>
    </div>

    <!-- Rest of the content remains the same -->
    
    <script>
        const chartData = {{ chart_data|safe }};
        const ctx = document.getElementById('performanceChart').getContext('2d');
        let chart;
        let updateInterval;

        async function fetchPrices() {
            const chartStatus = document.getElementById('chartStatus');
            const chartError = document.getElementById('chartError');
            
            try {
                chartStatus.style.display = 'block';
                const response = await fetch('/api/prices');
                const data = await response.json();
                
                if (data.errors && data.errors.length > 0) {
                    chartError.textContent = data.errors.join(', ');
                } else {
                    chartError.textContent = '';
                }
                
                return data;
            } catch (error) {
                chartError.textContent = 'Failed to fetch price data';
                console.error('Error fetching prices:', error);
                return null;
            } finally {
                chartStatus.style.display = 'none';
            }
        }

        function updateChart(darkMode) {
            const chartConfig = {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Token Prices (USD)',
                        data: chartData.values,
                        backgroundColor: darkMode ? '#00ff9d' : '#ff69b4',
                        borderColor: darkMode ? '#00ff9d' : '#ff69b4',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Comic Neue'
                                },
                                color: darkMode ? '#fff' : '#666'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: darkMode ? '#fff' : '#666'
                            },
                            grid: {
                                color: darkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: darkMode ? '#fff' : '#666',
                                callback: function(value) {
                                    return '$' + value.toFixed(4);
                                }
                            },
                            grid: {
                                color: darkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            };

            if (chart) {
                chart.destroy();
            }
            chart = new Chart(ctx, chartConfig);
        }

        // Initial chart creation
        updateChart(document.body.classList.contains('dark-mode'));

        // Set up periodic updates
        async function startPriceUpdates() {
            const updatePrices = async () => {
                const newData = await fetchPrices();
                if (newData) {
                    chartData.labels = newData.labels;
                    chartData.values = newData.values;
                    updateChart(document.body.classList.contains('dark-mode'));
                }
            };

            // Initial update
            await updatePrices();

            // Set up interval for updates
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            updateInterval = setInterval(updatePrices, 30000); // Update every 30 seconds
        }

        // Start price updates when DOM is loaded
        document.addEventListener('DOMContentLoaded', startPriceUpdates);
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
